# 데드락(DeadLock)

# 한 문장 정리‼️

### 데드락(Deadlock)

프로세스가 자원을 얻지 못해 다음 처리를 하지 못하는 상태를 **데드락 상태 == 교착 상태**라고 부릅니다

이는 시스템적으로 한정된 자원을 여러 곳에서 사용하려고 할 때 발생합니다.

---

# 0. 데드락이란?

프로세스가 자원을 얻지 못해 다음 처리를 하지 못하는 상태 == 교착 상태

# 1. 데드락이 일어나는 경우

### (1) 프로세스 1,2 가 자원 1,2를 얻어야 한다고 가정할 때

**조건**

- p1이 r1을 얻고 p2가 r2를 얻음
- p1이 r2을, p2가 r1을 기다림.

서로 원하는 리소스가 상대방에게 할당되어 있기 때문에, 두 프로세스는 **무한정** 기다리게 됨.

→ 이런 상태를 데드락이라고 함.

### (2) 멀티 프로그래밍 환경에서 한정된 자원을 사용하려고 서로 경쟁하는 상황

**조건**

- p1이 r1을 요청했을 떄, 그시각에 그 자원을 사용할 수 없는 상황이 발생
- p1은 대기 상태로 들어감.
- **대기** 상태로 들어간 프로세스들이 **실행** 상태로 변경 될 수 없을 때 → 교착 상태

# 2. 데드락 발생 조건

**4가지 조건이 동시에 성립될 때 발생함.** 즉, 하나라도 성리보디지 않는다면 교착 상태를 해결할 수 있음.

1) 상호 배제 (Mutual Exclusion)

- 자원은 **한 번에 한 프로세스**만 사용

2) 점유 대기 (Hold and Wait)

- 최소한 하나의 자원을 **점유**하고 있으면서 다른 프로세스에 할당 되어 있는 자원을 추가로 점유하기 위해 **대기**하는 프로세스가 존재.

3) 비선점 (No Preemption)

- 다른 프로세스에 할당된 자원은 사용이 끝날 때까지 **강제적으로 빼앗을 수 없음.**

4) 순환 대기 (Circular wait)

- 프로세스의 집합(P0~PN)이 원형 연결 리스트 형태로 **점유와 대기**를 해야 함.

# 3. 데드락 해결 방법

### 1) 예방

교착 상태 발생 조건 중 하나를 제거함으로 해결하는 방법

- 단점 : 자원 낭비가 심함.

**종류**

- 상호 배제 부정
    - 여러 개의 프로세스가 공유 자원을 사용할 수 있도록 함.
- 점유 대기 부정
    - 프로세스가 실행되기 전 필요한 모든 자원을 할당함.
- 비선점 부정
    - 자원을 점유하고 있는 프로세스가 다른 자원을 요구할 때 점유하고 있는 자원을 반납하고 요구한 자원을 사용하기 위해 기다리게 함
- 순환 대기 부정
    - 자원에 고유한 번호를 할당하고 번호 순서대로 자원을 요구하도록 함.

### 2) 회피

교착 상태가 발생하면 피해가는 방법

- 은행원 알고리즘
    - 은행에서 모든 고객의 요구가 충족되도록 현금을 할당하는데서 유래
    - 프로세스가 자원을 요구할 때, 시스템은 자원을 할당한 후에도 안정 상태로 남아있게 되는지 사전에 검사해서 교착 상태를 회피
    - 안정 상태면 자원 할당하고 아니면 다른 프로세스들이 자원을 해지하기까지 대기

### 3) 탐지

자원 할당 그래프를 통해 교착 상태를 탐지함.

- 단점 : 자원 요청시, 탐지 알고리즘을 실행시켜 그에 대한 오버헤드가 발생함.

### 4) 회복

**데드락 탐지 기법을 통해 데드락을 발견했다면!**

교착 상태를 일으킨 프로세스를 종료하거나, 할당된 자원을 해제시켜 **회복**시킴.

**종류** 

- 프로세스 종료 방법
    - 교착 상태의 프로세스를 모두 중지
    - 교착 상태가 제거될 때까지 하나씩 프로세스 중지
- 자원 선점 방법
    - 교착 상태의 프로세스가 점유하고 있는 자원을 선점해 다른 프로세스에게 할당
    - 우선순위가 낮은 프로세스나 수행횟수가 적은 프로세스 위주로 프로세스 자원 선점.

---

### 참고자료

[데드락이란?](https://velog.io/@woga1999/%EB%8D%B0%EB%93%9C%EB%9D%BD%EA%B3%BC-Starvation)